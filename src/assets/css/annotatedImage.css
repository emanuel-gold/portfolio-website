/* ---- Base layout ---- */
.annotated { position: relative; width: 100%; /* optionally control with aspect-ratio via macro */ }
.annotated > img { display: block; width: 100%; height: auto; }
.annotated { --caption-w: 220px; --pin-size: 24px; --cap-pad: 8px; }

/* ---- Elements ---- */
.annotated__callout--desktop { display: none; }
.annotated__marker, .annotated__caption, .annotated__leader { position: absolute; }

/* Marker (summary acts as the button) */
.annotated__marker {
  top: var(--y); left: var(--x);
  width: var(--pin-size); height: var(--pin-size);
  border-radius: 50%;
  border: 1px solid rgba(0,0,0,.2);
  background: rgba(59,91,103,.10);
  transform: translate(-50%, -50%);
  cursor: pointer;
}
.annotated__marker > span { display: block; width: 100%; height: 100%; }

/* Leader line (desktop only) */
.annotated__leader { display: none; }
@media (min-width: 1200px) {
  .annotated__callout--desktop { display: block; }
  .annotated__callout--mobile { display: none; }
  .annotated__leader {
    top: calc(var(--y) + (var(--pin-size) / 2));
    left: calc(var(--x) + var(--pin-size));
    width: calc(100% - var(--x) - (var(--pin-size) / 2));
    height: 1px;
    background: rgba(59,91,103,.12);
    transform: translateY(-50%);
    display: block;
    pointer-events: none;
  }
  .annotated__callout.annotated__callout--left .annotated__leader {
    left: -18px;
    width: calc(var(--x) + 18px);
  }
}

/* Caption */
@media (min-width: 1200px) {
  .annotated__caption {
    top: var(--y);
    left: calc(100% + 18px);
    width: var(--caption-w);
    padding-left: 8px;
    border-left: 1px solid rgba(59,91,103,.12);
    color: rgba(59,91,103,.85);
    font: 13px/1.4 ui-monospace, SFMono-Regular, Menlo, monospace;
    transform: translateY(-50%);
  }
  .annotated__callout.annotated__callout--left .annotated__caption {
    left: auto; right: calc(100% + 18px);
    text-align: right;
    padding-left: 0; padding-right: 8px;
    border-left: 0; border-right: 1px solid rgba(59,91,103,.12);
  }
}

/* Mobile: make the caption a tooltip; no leader lines */
@media (max-width: 1199px) {
  .annotated__callout--desktop { display: none; }
  .annotated__caption {
    bottom: calc(100% - var(--y));
    left: var(--x);
    width: 200px;
    padding: var(--cap-pad);
    border-radius: 6px;
    background: #3b5b67;
    color: #fff;
    font: 12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    box-shadow: 0 10px 40px -10px rgba(0,0,0,.25);
    transform: translate(-50%, 8px);
    opacity: 0;
    pointer-events: none;
    transition: opacity .15s ease, transform .15s ease;
  }
  /* open state without JS */
  .annotated__callout[open] .annotated__caption {
    opacity: 1; pointer-events: auto; transform: translate(-50%, 0);
  }
}

/* Details/summary tweaks */
.annotated__callout summary { list-style: none; }
.annotated__callout summary::-webkit-details-marker { display: none; }
